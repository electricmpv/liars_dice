{"version":3,"sources":["file:///D:/editors/liars_dice_demo/client/assets/scripts/ui/lobby/services/chat-service.ts"],"names":["ChatService","sys","constructor","_listeners","Map","_messageList","_socket","_isConnected","_userId","_userName","init","localStorage","getItem","connect","Promise","resolve","console","log","setTimeout","emit","loadHistoryMessages","setupMockMessageReceiver","disconnect","sendMessage","content","message","trim","id","Date","now","type","senderId","senderName","timestamp","isRead","push","sendSystemMessage","historyMessages","getMockHistoryMessages","setInterval","Math","random","receiveMockMessage","mockSenders","name","mockContents","sender","floor","length","baseTime","on","eventName","callback","target","has","set","get","off","listeners","i","listener","splice","args","apply"],"mappings":"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","sourcesContent":["import { sys } from 'cc';\n\n/**\n * ËÅäÂ§©ÊúçÂä°Á±ª\n * Ë¥üË¥£Â§ÑÁêÜËÅäÂ§©Áõ∏ÂÖ≥ÁöÑÁΩëÁªúËØ∑Ê±ÇÂíåÊï∞ÊçÆÁÆ°ÁêÜ\n */\nexport class ChatService {\n    private _listeners: Map<string, Array<{ callback: Function, target: any }>> = new Map();\n    private _messageList: any[] = [];\n    private _socket: any = null;\n    private _isConnected: boolean = false;\n    private _userId: string = '';\n    private _userName: string = '';\n\n    constructor() {\n        this.init();\n    }\n\n    /**\n     * ÂàùÂßãÂåñ\n     */\n    private init(): void {\n        // Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÔºà‰ªéÊú¨Âú∞Â≠òÂÇ®ÊàñÂÖ®Â±ÄÁä∂ÊÄÅÔºâ\n        this._userId = sys.localStorage.getItem('userId') || 'user_123456';\n        this._userName = sys.localStorage.getItem('userName') || 'Áé©ÂÆ∂';\n    }\n\n    /**\n     * ËøûÊé•ËÅäÂ§©ÊúçÂä°Âô®\n     */\n    public async connect(): Promise<boolean> {\n        return new Promise((resolve) => {\n            console.log('[ChatService] ËøûÊé•ËÅäÂ§©ÊúçÂä°Âô®...');\n            \n            // Ê®°ÊãüËøûÊé•ËøáÁ®ã\n            setTimeout(() => {\n                this._isConnected = true;\n                console.log('[ChatService] ËÅäÂ§©ÊúçÂä°Âô®ËøûÊé•ÊàêÂäü');\n                \n                // Ëß¶ÂèëËøûÊé•ÊàêÂäü‰∫ã‰ª∂\n                this.emit('connected');\n                \n                // Âä†ËΩΩÂéÜÂè≤Ê∂àÊÅØ\n                this.loadHistoryMessages();\n                \n                // ËÆæÁΩÆÊ®°ÊãüÊé•Êî∂Ê∂àÊÅØ\n                this.setupMockMessageReceiver();\n                \n                resolve(true);\n            }, 1000);\n        });\n    }\n\n    /**\n     * Êñ≠ÂºÄËøûÊé•\n     */\n    public disconnect(): void {\n        if (!this._isConnected) {\n            return;\n        }\n        \n        console.log('[ChatService] Êñ≠ÂºÄËÅäÂ§©ÊúçÂä°Âô®ËøûÊé•');\n        this._isConnected = false;\n        \n        // Ëß¶ÂèëÊñ≠ÂºÄËøûÊé•‰∫ã‰ª∂\n        this.emit('disconnected');\n    }\n\n    /**\n     * ÂèëÈÄÅÊ∂àÊÅØ\n     */\n    public sendMessage(content: string): void {\n        if (!this._isConnected) {\n            this.emit('chat-error', { message: 'Êú™ËøûÊé•Âà∞ËÅäÂ§©ÊúçÂä°Âô®' });\n            return;\n        }\n        \n        if (!content.trim()) {\n            return;\n        }\n        \n        console.log(`[ChatService] ÂèëÈÄÅÊ∂àÊÅØ: ${content}`);\n        \n        // ÂàõÂª∫Ê∂àÊÅØÂØπË±°\n        const message = {\n            id: `msg_${Date.now()}`,\n            type: 0, // 0: Ëá™Â∑±, 1: ÂÖ∂‰ªñÁé©ÂÆ∂, 2: Á≥ªÁªüÊ∂àÊÅØ\n            senderId: this._userId,\n            senderName: this._userName,\n            content: content,\n            timestamp: Date.now(),\n            isRead: true\n        };\n        \n        // Ê∑ªÂä†Âà∞Ê∂àÊÅØÂàóË°®\n        this._messageList.push(message);\n        \n        // Ëß¶ÂèëÊ∂àÊÅØÂèëÈÄÅ‰∫ã‰ª∂\n        this.emit('message-sent', message);\n        \n        // Âú®ÁúüÂÆûÁéØÂ¢É‰∏≠Â∫îÈÄöËøáWebSocketÂèëÈÄÅÂà∞ÊúçÂä°Âô®\n        // ËøôÈáåÂè™ÊòØÊ®°ÊãüÂÆûÁé∞\n    }\n\n    /**\n     * ÂèëÈÄÅÁ≥ªÁªüÊ∂àÊÅØ\n     */\n    public sendSystemMessage(content: string): void {\n        // ÂàõÂª∫Á≥ªÁªüÊ∂àÊÅØÂØπË±°\n        const message = {\n            id: `sys_${Date.now()}`,\n            type: 2, // Á≥ªÁªüÊ∂àÊÅØ\n            senderId: 'system',\n            senderName: 'Á≥ªÁªü',\n            content: content,\n            timestamp: Date.now(),\n            isRead: false\n        };\n        \n        // Ê∑ªÂä†Âà∞Ê∂àÊÅØÂàóË°®\n        this._messageList.push(message);\n        \n        // Ëß¶ÂèëÊ∂àÊÅØÊé•Êî∂‰∫ã‰ª∂\n        this.emit('message-received', message);\n    }\n\n    /**\n     * Âä†ËΩΩÂéÜÂè≤Ê∂àÊÅØ\n     */\n    private loadHistoryMessages(): void {\n        // Ê®°ÊãüÂä†ËΩΩÂéÜÂè≤Ê∂àÊÅØ\n        setTimeout(() => {\n            const historyMessages = this.getMockHistoryMessages();\n            \n            // Ê∑ªÂä†Âà∞Ê∂àÊÅØÂàóË°®\n            this._messageList = [...historyMessages, ...this._messageList];\n            \n            // Ëß¶ÂèëÂéÜÂè≤Ê∂àÊÅØÂä†ËΩΩ‰∫ã‰ª∂\n            this.emit('history-loaded', historyMessages);\n            \n            // ÂèëÈÄÅ‰∏ÄÊù°Á≥ªÁªüÊ¨¢ËøéÊ∂àÊÅØ\n            this.sendSystemMessage('Ê¨¢ËøéÊù•Âà∞ÂêπÁâõÈ™∞Â≠êÊ∏∏ÊàèËÅäÂ§©ÂÆ§ÔºÅ');\n        }, 500);\n    }\n\n    /**\n     * ËÆæÁΩÆÊ®°ÊãüÊ∂àÊÅØÊé•Êî∂Âô®\n     */\n    private setupMockMessageReceiver(): void {\n        // Ê®°ÊãüÂÆöÊó∂Êé•Êî∂Ê∂àÊÅØ\n        setInterval(() => {\n            // 30%Ê¶ÇÁéáÊî∂Âà∞Êñ∞Ê∂àÊÅØ\n            if (Math.random() < 0.3) {\n                this.receiveMockMessage();\n            }\n        }, 15000); // ÊØè15ÁßíÊ£ÄÊü•‰∏ÄÊ¨°\n    }\n\n    /**\n     * Êé•Êî∂Ê®°ÊãüÊ∂àÊÅØ\n     */\n    private receiveMockMessage(): void {\n        const mockSenders = [\n            { id: 'user_234567', name: 'ÊùéÂõõ' },\n            { id: 'user_345678', name: 'Áéã‰∫î' },\n            { id: 'user_456789', name: 'ËµµÂÖ≠' },\n            { id: 'user_567890', name: 'Èí±‰∏É' }\n        ];\n        \n        const mockContents = [\n            'Â§ßÂÆ∂Â•ΩÔºÅ',\n            'Êúâ‰∫∫‰∏ÄËµ∑Áé©ÂêóÔºü',\n            'ËøôÂ±ÄÊàëÁúüÊòØÂ§™ÂÄíÈúâ‰∫Ü...',\n            'ÂìàÂìàÔºåÊàëËµ¢‰∫ÜÔºÅ',\n            'ËøôÊ∏∏ÊàèÂ§™Â•ΩÁé©‰∫Ü',\n            'Ë∞ÅÊù•ÊïôÊàëÊÄé‰πàÁé©Ôºü',\n            'ÂàöÊâçÈÇ£ÊääÁúüÁ≤æÂΩ©ÔºÅ',\n            'üòäüòäüòä',\n            'Êúâ‰∫∫Âú®ÂêóÔºü',\n            '‰ªäÂ§©Â§©Ê∞îÁúüÂ•Ω'\n        ];\n        \n        // ÈöèÊú∫ÈÄâÊã©ÂèëÈÄÅËÄÖÂíåÂÜÖÂÆπ\n        const sender = mockSenders[Math.floor(Math.random() * mockSenders.length)];\n        const content = mockContents[Math.floor(Math.random() * mockContents.length)];\n        \n        // ÂàõÂª∫Ê∂àÊÅØÂØπË±°\n        const message = {\n            id: `msg_${Date.now()}`,\n            type: 1, // ÂÖ∂‰ªñÁé©ÂÆ∂\n            senderId: sender.id,\n            senderName: sender.name,\n            content: content,\n            timestamp: Date.now(),\n            isRead: false\n        };\n        \n        // Ê∑ªÂä†Âà∞Ê∂àÊÅØÂàóË°®\n        this._messageList.push(message);\n        \n        // Ëß¶ÂèëÊ∂àÊÅØÊé•Êî∂‰∫ã‰ª∂\n        this.emit('message-received', message);\n    }\n\n    /**\n     * Ëé∑ÂèñÊ®°ÊãüÂéÜÂè≤Ê∂àÊÅØ\n     */\n    private getMockHistoryMessages(): any[] {\n        const baseTime = Date.now() - 1000 * 60 * 30; // 30ÂàÜÈíüÂâç\n        \n        return [\n            {\n                id: 'msg_001',\n                type: 2, // Á≥ªÁªüÊ∂àÊÅØ\n                senderId: 'system',\n                senderName: 'Á≥ªÁªü',\n                content: 'Ê¨¢ËøéÊù•Âà∞ÂêπÁâõÈ™∞Â≠êÊ∏∏ÊàèËÅäÂ§©ÂÆ§ÔºÅ',\n                timestamp: baseTime,\n                isRead: true\n            },\n            {\n                id: 'msg_002',\n                type: 1, // ÂÖ∂‰ªñÁé©ÂÆ∂\n                senderId: 'user_234567',\n                senderName: 'ÊùéÂõõ',\n                content: 'Â§ßÂÆ∂Â•ΩÔºåÊúâ‰∫∫Ë¶Å‰∏ÄËµ∑Áé©ÂêóÔºü',\n                timestamp: baseTime + 1000 * 60 * 2, // 2ÂàÜÈíüÂêé\n                isRead: true\n            },\n            {\n                id: 'msg_003',\n                type: 1, // ÂÖ∂‰ªñÁé©ÂÆ∂\n                senderId: 'user_345678',\n                senderName: 'Áéã‰∫î',\n                content: 'ÊàëÊù•ÔºÅ',\n                timestamp: baseTime + 1000 * 60 * 4, // 4ÂàÜÈíüÂêé\n                isRead: true\n            },\n            {\n                id: 'msg_004',\n                type: 0, // Ëá™Â∑±\n                senderId: this._userId,\n                senderName: this._userName,\n                content: 'ÁÆóÊàë‰∏Ä‰∏™',\n                timestamp: baseTime + 1000 * 60 * 5, // 5ÂàÜÈíüÂêé\n                isRead: true\n            },\n            {\n                id: 'msg_005',\n                type: 1, // ÂÖ∂‰ªñÁé©ÂÆ∂\n                senderId: 'user_234567',\n                senderName: 'ÊùéÂõõ',\n                content: 'Â•ΩÔºåÊàëÂàõÂª∫ÊàøÈó¥‰∫ÜÔºåÊàøÈó¥Âè∑ÔºöR123456',\n                timestamp: baseTime + 1000 * 60 * 6, // 6ÂàÜÈíüÂêé\n                isRead: true\n            },\n            {\n                id: 'msg_006',\n                type: 2, // Á≥ªÁªüÊ∂àÊÅØ\n                senderId: 'system',\n                senderName: 'Á≥ªÁªü',\n                content: 'Áé©ÂÆ∂ÊùéÂõõÂàõÂª∫‰∫ÜÊàøÈó¥ R123456',\n                timestamp: baseTime + 1000 * 60 * 6.1, // 6.1ÂàÜÈíüÂêé\n                isRead: true\n            },\n            {\n                id: 'msg_007',\n                type: 1, // ÂÖ∂‰ªñÁé©ÂÆ∂\n                senderId: 'user_456789',\n                senderName: 'ËµµÂÖ≠',\n                content: 'Êàë‰πüÊù•Áé©ÔºÅ',\n                timestamp: baseTime + 1000 * 60 * 8, // 8ÂàÜÈíüÂêé\n                isRead: true\n            },\n            {\n                id: 'msg_008',\n                type: 1, // ÂÖ∂‰ªñÁé©ÂÆ∂\n                senderId: 'user_456789',\n                senderName: 'ËµµÂÖ≠',\n                content: 'ÂàöÊâçÈÇ£ÊääÁúüÊòØÂ§™Âà∫ÊøÄ‰∫ÜÔºå‰∏ãÊ¨°ÂÜçÊàòÔºÅ',\n                timestamp: baseTime + 1000 * 60 * 20, // 20ÂàÜÈíüÂêé\n                isRead: true\n            }\n        ];\n    }\n\n    /**\n     * Ê≥®ÂÜå‰∫ã‰ª∂ÁõëÂê¨\n     */\n    public on(eventName: string, callback: Function, target?: any): void {\n        if (!this._listeners.has(eventName)) {\n            this._listeners.set(eventName, []);\n        }\n        \n        this._listeners.get(eventName)?.push({ callback, target });\n    }\n\n    /**\n     * ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨\n     */\n    public off(eventName: string, callback: Function, target?: any): void {\n        if (!this._listeners.has(eventName)) {\n            return;\n        }\n        \n        const listeners = this._listeners.get(eventName);\n        if (!listeners) return;\n        \n        for (let i = listeners.length - 1; i >= 0; i--) {\n            const listener = listeners[i];\n            if (listener.callback === callback && (!target || listener.target === target)) {\n                listeners.splice(i, 1);\n            }\n        }\n    }\n\n    /**\n     * Ëß¶Âèë‰∫ã‰ª∂\n     */\n    private emit(eventName: string, ...args: any[]): void {\n        if (!this._listeners.has(eventName)) {\n            return;\n        }\n        \n        const listeners = this._listeners.get(eventName);\n        if (!listeners) return;\n        \n        for (const listener of listeners) {\n            if (listener.target) {\n                listener.callback.apply(listener.target, args);\n            } else {\n                listener.callback(...args);\n            }\n        }\n    }\n}\n"]}